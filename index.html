<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8">
    <title>antBlock IDE</title>
    <!--include necessary javascript and css libraries and such
    //CREATE NEW JAVASCRIPT FILE FOR LOADING TO BOARD, INCLUDE HERE WITH SRC PATH-->
    <script src="blockly/blockly_compressed.js"></script>
    <script src="blockly/javascript_compressed.js"></script>
    <script src="blockly/blocks_compressed.js"></script>
    <script src="blockly/msg/js/en.js"></script>
    <script src="blockly/blocks/robot.js"></script>
    <script src="arduino_manager.js"></script>
    <link rel="stylesheet" href="bootstrap-4.3.1-dist\css\bootstrap.min.css">
    <link href="images\fontawesome-free-5.9.0-web\css\all.css" rel="stylesheet">
    <script src="bootstrap-4.3.1-dist\js\bootstrap.min.js"></script>
    <script src="jquery-3.4.1.min.js"></script>
    <script src="./renderer.js"></script>
    <script src="node_modules\file-saver\dist\FileSaver.min.js">

    <!--To make the code look pretty -->
    <link rel="stylesheet" href="highlight\styles\arduino-light.css">
    <script src="highlight\highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <style>
        html, body {
            height: 100%;
            margin: 2;
        }

        body {
            background-color: #fff;
            height: 100%;
            overflow: hidden;
        }

        #blocklyDiv {
            height: 50%;
        }

        #rowOne {
            height: 90vh;
        }

        .card-header{
            background-color:#00630a;
        }

        /*#codeDiv {
            border-style: solid;
            border-width: 2px;
            border-color: #42cbf5;
            background-color: #F3EFF3;
        }*/
    </style>

</head>
<body>


    <!--NAVBAR. ADD BUTTONS HERE-->
    <nav class="navbar navbar-expand-sm" style="background-color: #00630a;">
        <div class="navbar-brand text-white" href="#">
            <i class="fas fa-code mr-2"></i>antBlock
        </div>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse text-white mt-1" id="navbarNavDropdown">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <!--CHANGE THE ONCLICK FUNCTION TO THE FUNCTION IN THE NEW JS FILE.-->
                    <button type="button" class="btn btn-outline-light mx-1" data-toggle="tooltip" data-placement="bottom" title="Restore Default" onclick="changeSpinner(true)" onmouseover="textChange(1)" onmouseout="textReverse()">
                        <i class="fas fa-redo"></i>
                    </button>
                </li>
                <li class="nav-item active">
                    <button type="button" class="btn btn-outline-light mx-1" data-toggle="tooltip" data-placement="bottom" title="Upload" onclick="upload()" onmouseover="textChange(2)" onmouseout="textReverse()">
                        <i class="fas fa-arrow-circle-down"></i>
                    </button>
                </li>
                <li class="nav-item active">
                    <button type="button" class="btn btn-outline-light mx-1" data-toggle="tooltip" data-placement="bottom" title="Check Devices" id="check" onclick="checkDevices()" onmouseover="textChange(3)" onmouseout="textReverse()">
                        <i class="fab fa-usb"></i>
                    </button>
                </li>
                <li class="nav-item active">
                    <button type="button" class="btn btn-outline-light mx-1" data-toggle="tooltip" data-placement="bottom" title="Save" id="save" onclick="saveFile()" onmouseover="textChange(4)" onmouseout="textReverse()">
                        <i class="fas fa-file-download"></i>
                    </button>
                </li>
                <li class="nav-item active">
                    <button type="button" class="btn btn-outline-light mx-1" data-toggle="tooltip" data-placement="bottom" title="Load" id="load" onclick="loadFile()" onmouseover="textChange(5)" onmouseout="textReverse()">
                        <i class="fas fa-file-upload"></i>
                    </button>
                </li>

                <li class="nav-item disabled">
                    <button type="button" class="btn btn-outline-light mx-1 d-flex" data-toggle="tooltip" data-placement="bottom" title="Current Port">
                        <div id="port">
                            <i class="fas fa-file-export mr-1"></i>No Port Detected:
                        </div>
                    </button>
                </li>
                <li class="nav-item disabled">
                    <div>
                        <div class="mt-2 mx-4" id="textChanged"></div>
                    </div>
                </li>
            </ul>
            <ul class="navbar-nav" id="uploadMessage">

                <!--<li class="nav-item">
                    <div class="spinner-border text-light mr-auto" role="status">
                        <span class="sr-only">Loading...</span>
                    </div>
                </li>
                <h6 class="mt-1 mx-2">Uploading...</h6>-->
            </ul>
        </div>
    </nav>
    <input type="file" id="loadFile" accept=".txt" hidden>

    <script>



                //THIS FUNCTION UPDATES THE CONVERTED CODE. MAKE THIS FUNCTION WORK WITH THE CHANGE LISTENER FOR INSTANT CHANGE OF CODE
                function myUpdateFunction() {
                    var code = Blockly.JavaScript.workspaceToCode(workspace);

                        alert(code);
                        document.getElementById("code").innerHTML = code;
                    }


                    workspace.addChangeListener(myUpdateFunction);


                function uploadToArduino(event) {
                    var code = Blockly.Arduino.workspaceToCode(workspace);
                        alert(code);
                        upload(code);
                        alert("Upload complete");
                    }

                function textChange(button) {
                    switch (button) {
                        case 1:
                            document.getElementById("textChanged").innerHTML = "Restore to Default";
                            break;
                        case 2:
                            document.getElementById("textChanged").innerHTML = "Upload to antBot";
                            break;
                        case 3:
                            document.getElementById("textChanged").innerHTML = "Refresh COM Ports";
                            break;
                        case 4:
                            document.getElementById("textChanged").innerHTML = "Save";
                            break;
                        case 5:
                            document.getElementById("textChanged").innerHTML = "Load";
                            break;
                        default:
                            document.getElementById("textChanged").innerHTML = "";
                    }
                }

                function textReverse() {
                            document.getElementById("textChanged").innerHTML = "";
                        }

    </script>


    <div class="row container-fluid my-4" id="rowOne">
        <div class="col-8">
            <div id="blocklyDiv" style="height: 95%; width: 100%"></div>
        </div>


        <script>

                        //WE CHANGE THE HSV SO IT DOESN'T LOOK LIKE DEFAULT BLOCKLY
                        Blockly.HSV_SATURATION = .55// 0 (inclusive) to 1 (exclusive), defaulting to 0.45
                        Blockly.HSV_VALUE = .95// 0 (inclusive) to 1 (exclusive), defaulting to 0.65

        </script>
        <!-- include all the blocks in the toolbox-->
        <xml id="toolbox" style="display: none">
            <category name="Robot" colour=0>
                <block type="robot_start"></block>
                <block type="robot_end"></block>

            </category>
            <category name="Logic" colour="%{BKY_LOGIC_HUE}">
                <category name="If">
                    <block type="controls_if"></block>
                    <block type="controls_if">
                        <mutation else="1"></mutation>
                    </block>
                    <block type="controls_if">
                        <mutation elseif="1" else="1"></mutation>
                    </block>
                </category>
                <category name="Boolean" colour="%{BKY_LOGIC_HUE}">
                    <block type="logic_compare"></block>
                    <block type="logic_operation"></block>
                    <block type="logic_negate"></block>
                    <block type="logic_boolean"></block>
                    <block type="logic_null"></block>
                    <block type="logic_ternary"></block>
                </category>
            </category>
            <category name="Loops" colour="%{BKY_LOOPS_HUE}">
                <block type="controls_repeat_ext">
                    <value name="TIMES">
                        <block type="math_number">
                            <field name="NUM">10</field>
                        </block>
                    </value>
                </block>
                <block type="controls_whileUntil"></block>
                <block type="controls_for">
                    <field name="VAR">i</field>
                    <value name="FROM">
                        <block type="math_number">
                            <field name="NUM">1</field>
                        </block>
                    </value>
                    <value name="TO">
                        <block type="math_number">
                            <field name="NUM">10</field>
                        </block>
                    </value>
                    <value name="BY">
                        <block type="math_number">
                            <field name="NUM">1</field>
                        </block>
                    </value>
                </block>
                <block type="controls_forEach"></block>
                <block type="controls_flow_statements"></block>
            </category>


        </xml>

        <div class=" col-4">
            <div class="card mb-4" style="height:45%">
                <div class="card-header text-white form-inline">
                    <div>
                        Code
                    </div>
                    <button type="button" class="btn btn-outline-light mx-2">Light</button>

                </div>
                <div class="card-body overflow-auto">
                    <pre><code class="c++" id="code">#include antBot</code></pre>
                </div>
            </div>

            <div class="card mt-4" style="height:45%">
                <div class="card-header text-white">
                    Messages
                </div>
                <div class="card-body">
                    <div class="input-group mb-3">

                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>

                //INJECT BLOCKLY INTO DIV
                var workspace = Blockly.inject('blocklyDiv',
            {toolbox: document.getElementById('toolbox') });
    </script>

</body>
</html>
